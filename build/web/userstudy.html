<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>User Study</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script type="text/javascript" src="question-properties.js"></script>
        <script src="http://d3js.org/d3.v3.js"></script> 
        <script src="jquery-1.10.2.js"></script>
        <script type="text/javascript" src="utils.js"></script>
        <style type="text/css" >
            #viewers{
                border:2px solid;
                padding: 0px;
                float: left;
                height: 800px;
                width: 860px;
                display: block;
            }
            #viewerFrame1{
                border: none;
                height: 800px;
                width: 800px;
                display: none;
            }
            #viewerFrame2{
                display: none;
                border: none;
                height: 720px;
                width: 1020px;
            }
            #viewerFrame{
                //display: none;
                border: none;
                height: 800px;
                width: 860px;
            }
            #propControl{
                float: right;
                width: 350px;
                height: 780px;
                border: solid #000;
                padding: 10px;
                font-size: 120%;
            }
            #checkAnswer{
                display:none;
            }
            #correctnessOfAnswer{
                font-weight: bold;
            }
            #afterTrialControls{
                display:none;
                padding: 10px;
            }
            #turkcode{
                font-weight: bold;
            }
            #endOfQuantitative{
                display: none;
            }
            #blankViewer{
                border: 1px solid;
                height: 800px;
                width: 850px;
                float: left;
                display: none;
            }
            #durationCountDown{
                margin-left: 50px;
                font-size: 18pt;
            } 
            #introduction{
                padding: 50px;
                padding-top:0px;
                border:none;
            }
            #introductionframe{
                width: 100%;

                border:none;  
            }

            .legendTitle{
                text-align: center;
                text-decoration: underline;
            }
            #legendDiv{
                margin-left: 20px;
                marging-right: 20px;
                width: 300px;
                height: 300px;
            }
            .center{
                margin-left: 30%;
                margin-right: 30%;
            }
            body{
                height: 100%;
            }
            #study{
              //  width: 1250px;
            }


        </style>
        <script type="text/javascript">
            var taskCounter = 0;
            var stage = 0;
            var question = "";
            var isTutorial = "true";
            var viewersChanged = false;
            var instruction;
            var countdownInterval;
            var maxtime = 1;
            var questionDurationIntv;
            var maxQuestionDuration = 10;
            var currDuration;
            var currQuestionTime = 0;
            var gettingTurkID = "false";
            var durationRecorded = false;
            var nodePosInterval;
            var datasetInterval;
            var questionsPrepared = false;
            var propControlWidth = 350;

            window.onload = function() {
                getInstruction();
            };


            window.onkeyup = function(event) {

                event = event || window.event; // IE-ism

                var keyCode = event.keyCode;
                // alert(studystarted);
                //alert(keyCode);

                if (keyCode == 13 && (studystarted == true || trainingstarted == true)) { //click the next                     
                    advanceButtonClicked();
                }
                else if (keyCode == 13 && (gettingTurkId == true)) {
                    startStudy();  //call the start study method, which the button would have called anyway.
                }


            };

            function startTraining() {
                trainingstarted = true;
                getQuestion();
            }


            /*If you want to change the default introduction, you need to have a method set introduction in your viewers*/
            function getIntroduction() {
                //alert("I'm getting the introduction");

                var iframe = document.getElementById("viewerFrame");

                var introductionPageName = "";
                var iframeurl = iframe.src;
                //alert(iframeurl);
                var ind = iframeurl.lastIndexOf("/");
                var pageLocation = iframeurl.substring(0, ind);
                iframe.onload = function() {

                    if (typeof iframe.contentWindow.setIntroduction == "function") {

                        introductionPageName = iframe.contentWindow.setIntroduction();

                        if (introductionPageName && introductionPageName !== "") {
                            var introPageUrl = pageLocation + "/" + introductionPageName;
                            //alert(introPageUrl);

                            var gi = document.getElementById("introductionframe");
                            gi.setAttribute("src", introPageUrl);



                            document.getElementById("defaultIntroduction").style.display = "none";
                            document.getElementById("givenIntroduction").style.display = "block";

                            $('.myIframe').css('height', $(window).height() + 'px'); //the height of that window

                        }
                    }
                };

                if (typeof iframe.contentWindow.setIntroduction == "function") {
                    introductionPageName = iframe.contentWindow.setIntroduction();

                    if (introductionPageName && introductionPageName !== "") {
                        var introPageUrl = pageLocation + "/" + introductionPageName;
                        //alert(introPageUrl);

                        var gi = document.getElementById("introductionframe");
                        gi.setAttribute("src", introPageUrl);

                        document.getElementById("defaultIntroduction").style.display = "none";
                        document.getElementById("givenIntroduction").style.display = "block";

                    }
                }


            }






            /**
             * Get the Instruction for the user study
             */
            function getInstruction() {
                var command = "instruction";

                var url = "StudyManager?command=" + command;

                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {                        //alert(xmlHttpRequest.responseText);
                        //alert(xmlHttpRequest.responseText);
                        var split = (xmlHttpRequest.responseText).split("::");
                        var header = split[0];
                        var note = split[1];
                        document.getElementById("noteHeader").innerHTML = header;
                        document.getElementById("note").innerHTML = note;

                        document.getElementById("studyid").value = split[2];
                        getFirstConditionViewer(); //call the first condition vie                                
                    }
                };

                xmlHttpRequest.open("GET", url, true);
                xmlHttpRequest.send();
            }

            /**
             * This method gets the url of the first condition viewer 
             */
            function getFirstConditionViewer() {
                var command = "firstViewerUrl";

                var studyid = document.getElementById("studyid").value;
                //  "&studyid="+studyid;

                // alert(studyid  + " -- studyid in firstcondit");
                var url = "StudyManager?command=" + command + "&studyid=" + studyid;

                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {
                        // alert(xmlHttpRequest.responseText);
                        // alert(xmlHttpRequest.responseText);
                        createViewerFrame(xmlHttpRequest.responseText);
                        //set the introduction                           
                        getIntroduction();
                        getViewerDimensions();
                    }
                };

                xmlHttpRequest.open("GET", url, true);
                xmlHttpRequest.send();
            }

            //method to get the specified width and height of the specified by the evaluator
            function getViewerDimensions() {
                var command = "getViewerDimensions";
                var studyid = document.getElementById("studyid").value;

                var url = "StudyManager?command=" + command
                        + "&studyid=" + studyid;

                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {
                        //alert();
                        var dimensions = xmlHttpRequest.responseText;
                        var split = dimensions.split("x"); //e.g w x h  e.g. 800 x 600

                        //TODO: check if the they are actually integer values.

                        var width = Number(split[0]);
                        var height = Number(split[1]);

                        //set the dimensions of the viewers
                        var vframe = document.getElementById("viewerFrame");
                        vframe.style.width = width + "px";
                        vframe.style.height = height + "px";
                        
                        //resize the viewers div
                        var vParentFrame = document.getElementById("viewers");
                        vParentFrame.style.width = width + "px";
                        vParentFrame.style.height = height + "px";
                        
                        //resize the blankviewer div
                        var blankviewer = document.getElementById("blankViewer");
                        blankviewer.style.width = width + "px";
                        blankviewer.style.height = height + "px";
                        
                        //resize the study div //it should be the viewer width + the prop-control width
                        var studydiv = document.getElementById("study");
                        
                        
                        
                        //get the window width
                        var windowWidth = window.innerWidth
                            || document.documentElement.clientWidth
                            || document.body.clientWidth;                        
                        
                        var totalWidth = width + propControlWidth + 50;
                        
                        //set the width of the window in case it is >= total width
                        
                      //  if(windowWidth > totalWidth){
                              studydiv.style.width = totalWidth + "px";
                       /* }
                        else{ //redirect to a page  that shows that there is an error.
                             window.location.replace("screen-dimension-error.jsp?width="+totalWidth + "&height="+height);
                        } */
                          
                        
                       
                       
                        
                        
                        
                    }
                };

                xmlHttpRequest.open("GET", url, true);
                xmlHttpRequest.send();

            }


            function  prepareQuestions() {
                var command = "prepareQuestions";
                var studyid = document.getElementById("studyid").value;
                var graphType = "";    //"undirected"; //this is the default graph type in case the user does not specify one
                //get the graph type from the viewer iframe
                //  getGraphType()
                var iframe = document.getElementById("viewerFrame");
                if (typeof iframe.contentWindow.getGraphType == "function") {
                    graphType = iframe.contentWindow.getGraphType();
                }

                var url = "StudyManager?command=" + command
                        + "&studyid=" + studyid
                        + "&graphType=" + graphType;


                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {
                        //
                    }
                };

                xmlHttpRequest.open("GET", url, true);
                xmlHttpRequest.send();
            }

            /*
             * get the question from the server
             * 
             */
            function getQuestion() {
                if (stage === 0) {
                    //hide the beginTutorial button and show the next button
                    document.getElementById("beginTutorial").style.display = "none";
                    document.getElementById("nextButton").style.display = "block";

                    stage++;
                }

                if (isTutorial === "true") {
                    document.getElementById("correctnessOfAnswer").innerHTML = "";
                    checkIsTutorial();
                }

                //get the question
                //get the nodes involved in the question
                var previousAnswer = document.getElementById("selectedAnswer").value; //get the value of the previous Answer


                //reset the selected answer for subsequent questions
                document.getElementById("selectedAnswer").value = "";
                var studyid = document.getElementById("studyid").value;
                //  "&studyid="+studyid;
                var command = "getQuestion";
                var url = "StudyManager?command=" + command + "&previousAnswer="
                        + previousAnswer + "&previousTime=" + currQuestionTime + "&studyid=" + studyid;
                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {
                        var split = (xmlHttpRequest.responseText).split("::");
                        if (split[0] === "ChangeViewers") {
                            //TODO: //change the url of the viewer Frame to the new viewer
                            var newViewerUrl = split[1].trim();
                            var viewerFrame = document.getElementById("viewerFrame");

                            viewerFrame.setAttribute("src", newViewerUrl);
                            getAndSetNodePositions();
                            // getAndSetDataset();
                            //wait a couple of seconds and call the getQuestion method again
                            setTimeout(getQuestion, 1000);
                        }
                        else if (split[0] === "Finished") {
                            //alert("Finished Study");
                            var turkcode = split[1];
                            endOfQuantitative(turkcode);
                        }
                        else if (split[0] === "Feedback") {
                            //call the qualitative function
                            // alert(xmlHttpRequest.responseText)
                            showQualitativeQuestions(xmlHttpRequest.responseText);
                        }


                        else {
                            var qnheader = split[0];
                            var question = split[1];
                            //check if the method of the viewer needs the question to be changed. And change it accordingly.
                            var iframe = document.getElementById("viewerFrame");
                            if (typeof iframe.contentWindow.changeQuestion == "function") {
                                var newquestion = iframe.contentWindow.changeQuestion(question.trim());
                                if (newquestion !== "") { //if a newquestion was returned that set the question with  the new question
                                    question = newquestion;
                                }
                            }

                            //get the legend of the question if there is some 
                            if (typeof iframe.contentWindow.getQuestionLegend == "function") {
                                var imgname = "";
                                imgname = iframe.contentWindow.getQuestionLegend(question.trim());
                                showTaskLegend(imgname);
                            }

                            maxQuestionDuration = parseInt(split[2]);  // the maximum time for this task
                            document.getElementById("noteHeader").innerHTML = qnheader;
                            document.getElementById("note").innerHTML = question;

                            document.getElementById("selectedAnswer").value = "";

                            getAnswerControllers();
                            getNodes();
                            revealViewer();
                            if (studystarted == true) {
                                startQuestionDurationCountDown();
                            }
                          /*  else {
                                gettingTurkID = "false";
                            } */
                        }
                    }
                };
                xmlHttpRequest.open("GET", url, false);
                xmlHttpRequest.send();
            }

            /*
             * function to get the nodes from the server 
             */
            function getNodes() {
                // Give a command to get the nodes from the server
                var studyid = document.getElementById("studyid").value;
                //  "&studyid="+studyid;
                var command = "getNodes";
                var url = "StudyManager?command=" + command + "&studyid=" + studyid;
                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {
                        displayNodes(xmlHttpRequest.responseText);
                    }
                };
                xmlHttpRequest.open("GET", url, false);
                xmlHttpRequest.send();
            }

            /**
             * function to highlight the nodes involved in the question
             *  
             *  */
            function displayNodes(nodesStr) {
                //  alert("yay");
                var nodesArr = nodesStr.split(",");
                // alert(nodesArr);
                //alert(nodesStr)
                /*if (nodesArr && !viewersChanged) { //not null
                 document.getElementById("viewerFrame1").contentWindow.selectNode(nodesArr);
                 }
                 else {
                 document.getElementById("viewerFrame2").contentWindow.selectNode(nodesArr);
                 }  */

                document.getElementById("viewerFrame").contentWindow.selectNode(nodesArr);

            }
            /**
             * function that makes and returns an HttpRequest object 
             */
            function getXMLHttpRequest() {
                var xmlHttpReq;
                // to create XMLHttpRequest object in non-Microsoft browsers  
                if (window.XMLHttpRequest) {
                    xmlHttpReq = new XMLHttpRequest();
                } else if (window.ActiveXObject) {
                    try {
                        //to create XMLHttpRequest object in later versions of Internet Explorer  
                        xmlHttpReq = new ActiveXObject("Msxml2.XMLHTTP");
                    } catch (exp1) {
                        try {
                            //to create XMLHttpRequest object in later versions of Internet Explorer  
                            xmlHttpReq = new ActiveXObject("Microsoft.XMLHTTP");
                        } catch (exp2) {
                            //xmlHttpReq = false;  
                            alert("Exception in getXMLHttpRequest()!");
                        }
                    }
                }
                return xmlHttpReq;
            }

            /**
             * function that checks if the current question is a tutorial or not 
             */
            function checkIsTutorial() {

                var studyid = document.getElementById("studyid").value;
                //  "&studyid="+studyid;
                var command = "checkIsTutorial";
                var url = "StudyManager?command=" + command + "&studyid=" + studyid;

                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {
                        if (xmlHttpRequest.responseText === "true") {
                            showCheckAnswerButton();
                        }
                        else {
                            isTutorial = "false";
                            gettingTurkID = "true";
                            hideCheckAnswerButton();
                        }

                    }
                };

                xmlHttpRequest.open("GET", url, false);
                xmlHttpRequest.send();
            }

            function startQuestionDurationCountDown() {
                currDuration = maxQuestionDuration;
                durationRecorded = false;
                questionDurationIntv = setInterval("questionDurationCountDown()", 1000);
            }

            /**
             * function to countdown the timing for the question
             * 
             */
            function questionDurationCountDown() {
                currDuration--;

                document.getElementById("durationCountDown").innerHTML = "Duration:  " + currDuration;

                if (currDuration === 0) {
                    //show blank screen for the viewer
                    continueAfterQuestionDurationOver();
                    showBlankViewer();
                }
            }
            /**
             * function to hide the viewer 
             */
            function showBlankViewer() {
                document.getElementById("viewers").style.display = "none";
                document.getElementById("blankViewer").style.display = "block";
            }
            /**
             *  function to reveal the viewer
             */
            function revealViewer() {
                document.getElementById("blankViewer").style.display = "none";
                document.getElementById("viewers").style.display = "block";
            }
            /**
             * function that records the duration of the current question and continues to the next question.
             */
            function continueAfterQuestionDurationOver() {
                currQuestionTime = maxQuestionDuration - currDuration;//record the time.
                clearInterval(questionDurationIntv);  //clear the interval variable                
                durationRecorded = true;
            }
            /*
             * function that is executed when the next button is clicked.   
             */
            function advanceButtonClicked() {

                if (durationRecorded === false) {
                    continueAfterQuestionDurationOver();
                }

                var answer = document.getElementById("selectedAnswer").value;

                if (answer === "") {
                    alert("Please provide a valid answer before continuing");
                    return false;
                }
                //get the question
                getQuestion();
            }

            /**
             * This method creates a frame whose source will be the url that is passed to it.
             */
            function createViewerFrame(url) {

                var viewers = document.getElementById("viewers");
                var myframe = document.createElement("iframe");
                myframe.setAttribute("id", "viewerFrame");
                myframe.setAttribute("src", url);
                viewers.appendChild(myframe);
                //get the dataset      

                getAndSetNodePositions();
                //  getAndSetDataset();

            }
            //this function gets the dataset from the servlet and sets it for the iframe
            function getAndSetDataset() {

                // alert(document.getElementById(viewerFrame).src);

                var studyid = document.getElementById("studyid").value;
                //  "&studyid="+studyid;
                var command = "getDataset";
                var url = "StudyManager?command=" + command + "&studyid=" + studyid;


                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {
                        var dataset = xmlHttpRequest.responseText;

                        datasetInterval = setInterval(function() {
                            setFrameDataset(dataset);
                        }, 200);

                    }
                };

                xmlHttpRequest.open("GET", url, true);
                xmlHttpRequest.send();
            }

            function setFrameDataset(dataset) {
                var iframe = document.getElementById("viewerFrame");
                /* if (typeof iframe.contentWindow.setDataset == "function") {
                 //  alert("here");
                 iframe.contentWindow.setDataset(dataset);
                 clearInterval(datasetInterval);
                 }
                 else { */
                /*   var ind = dataset.lastIndexOf(".");
                 var dataset2 = dataset.substring(0, ind); */

                var dataset2 = dataset;

                //check the setdataset type that has been implemented
                if (typeof iframe.contentWindow.setJSONdataset == "function") { //json
                    dataset2 += ".json";
                    //alert(dataset2);
                    iframe.contentWindow.setJSONdataset(dataset2);
                    clearInterval(datasetInterval);
                }
                else if (typeof iframe.contentWindow.setCSVdataset == "function") {
                    dataset2 += ".csv";
                    iframe.contentWindow.setCSVdataset(dataset2);
                    clearInterval(datasetInterval);
                }
                else if (typeof iframe.contentWindow.setTSVdataset == "function") {
                    dataset2 += ".tsv";
                    iframe.contentWindow.setTSVdataset(dataset2);
                    clearInterval(datasetInterval);
                }
                // }


            }
            function setFrameNodePositions(nodePositions) {



                var iframe = document.getElementById("viewerFrame"); //set the node positions                        

                if (typeof iframe.contentWindow.setNodePositions == "function") {
                    //alert("here");
                    getAndSetDataset();

                    if (!questionsPrepared) { //questions will be prepared only once.
                        prepareQuestions();
                        questionsPrepared = true;
                    }


                    iframe.contentWindow.setNodePositions(nodePositions);
                    clearInterval(nodePosInterval);
                }
            }


            function getAndSetNodePositions() {
                var studyid = document.getElementById("studyid").value;
                //  "&studyid="+studyid;

                var command = "getNodePositions";
                var url = "StudyManager?command=" + command + "&studyid=" + studyid;

                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {

                        // alert(xmlHttpRequest.responseText);

                        var nodesAndPositions = xmlHttpRequest.responseText.split("::::");
                        var nodePositions = [];

                        for (var i = 0; i < nodesAndPositions.length; i++) {
                            var posValues = nodesAndPositions[i].split("::");
                            var name = posValues[0];
                            var x = Number(posValues[1]);
                            var y = Number(posValues[2]);
                            nodePositions[name] = {"x": x, "y": y};
                        }
                        nodePosInterval = setInterval(function() {
                            setFrameNodePositions(nodePositions);
                        }, 200);

                        //get and set the dataset

                    }
                    /*  else {
                     getAndSetDataset();
                     }  */
                };



                xmlHttpRequest.open("GET", url, true);
                xmlHttpRequest.send();
            }


            function showTheStudy() {
                //hide the introduction div and show the study div.
                document.getElementById("introduction").style.display = "none";
                document.getElementById("study").style.display = "block";
            }

            function getPreQualitativeQuestions() {

                var studyid = document.getElementById("studyid").value;


                var command = "getPreQualitativeQuestions";
                var url = "StudyManager?command=" + command + "&studyid=" + studyid;

                var xmlHttpRequest = getXMLHttpRequest();

                xmlHttpRequest.onreadystatechange = function()
                {
                    if (xmlHttpRequest.readyState === 4 && xmlHttpRequest.status === 200)
                    {
                        // alert(xmlHttpRequest.responseText);

                        if (xmlHttpRequest.responseText === "") {
                            showTheStudy();
                        }
                        else {
                            showTheStudy();
                            showPreQualitativeQuestions(xmlHttpRequest.responseText);
                        }
                    }
                };
                xmlHttpRequest.open("GET", url, true);
                xmlHttpRequest.send();
            }


            function showTaskLegend(imgname) {
                if (imgname !== "") {
                    var iframeurl = document.getElementById("viewerFrame").src;

                    var ind = iframeurl.lastIndexOf("/");
                    var pageLocation = iframeurl.substring(0, ind);

                    var imgurl = pageLocation + "/" + imgname;
                    var imgElement = document.createElement("img");
                    imgElement.setAttribute("src", imgurl);
                    // imgElement.setAttribute("width", "200px");
                    //imgElement.setAttribute("height", "200px");

                    var legendDiv = document.getElementById("legendDiv");
                    removeDivChildren(legendDiv);
                    //Legend

                    //create a title for the legend.
                    var title = document.createElement("h3");
                    title.setAttribute("class", "legendTitle");
                    title.innerHTML = "Legend";

                    legendDiv.appendChild(title);
                    legendDiv.appendChild(imgElement);
                    legendDiv.style.display = "block";
                }

            }




        </script>


    </head>
    <body>
        <div id="introduction">
            <u>(Please only use either Chrome or Firefox for this study. And please don't use the back button on the browser)</u><br>
            <br>
            <input class="center" type="button"  value="Got it! Take me to the study" onclick="getPreQualitativeQuestions();">

            <div id="defaultIntroduction">
                <h3>Introduction</h3>

                In this experiment we will show you visual representations of connectivity/network data and ask you to answer questions about this data.
                The visual representation will be on the left-hand side and the question and other instructions will be on the right-hand side. 
                There is a countdown for each question, and we will hide the visualization once the time is up.
                You will have to provide an answer for each question before continuing. Try and answer correctly as fast as possible.

                You will be provided with your turk-code after you finish the study. 
            </div>
            <div id="givenIntroduction" style="display:none;">
                <iframe id="introductionframe" src="" class="myIframe">  </iframe>  

                <script type="text/javascript" language="javascript">
                    $('.myIframe').css('height', $(window).height() + 'px');
                </script>

            </div>

            <br /> <br/>
            <input type="button" class="center" value="Got it! Take me to the study" onclick="showTheStudy();">
        </div>

        <div id="study" style="display:none;">
            <div id="viewers">  
                <!-- <iframe id="viewerFrame1" src="http://vizlab.cs.fiu.edu/d3graphevaluation/d3_force.html">  -->
                <!--<iframe id="viewerFrame1" src="http://localhost:8080/d3graphevaluation/d3_force.html">   
                </iframe>  -->

                <iframe id="viewerFrame2" src="" >
                </iframe> 
            </div> 

            <div id="blankViewer">
                <!-- <br><br><br><br><br>  -->
                <!--  <p><span id="countdown">2</span></p>  -->
            </div>



            <div id="propControl">  

                <div id="studyControls">

                    <h4 id="noteHeader"></h4>

                    <p id="note"></p>

                    <div id="answersDiv" style="display:none;">    
                    </div>
                    <input type="hidden" id="selectedAnswer" value=""/>
                    <input type="hidden" id="questionDuration" value="" />

                    <br>

                    <input id="beginTutorial" type="button" value="Begin Training" onclick="startTraining();" />

                    <p id="checkAnswer"><input type="button" value="Check Answer" onclick="checkAnswer();"/> &nbsp;&nbsp;
                        <label id="correctnessOfAnswer"></label>
                    </p>
                    <br><br>
                    <input id="nextButton" type="button" value="Next" onclick="advanceButtonClicked()" style="display:none;"/>


                    <br /><br /> 

                    <div id="durationCountDown">

                    </div>
                    <br /><br /> <br />
                    <div id="legendDiv" style="display:none">
                        <h4>Legend</h4>
                        <!--  <div id="legend"></div> -->

                    </div>


                </div>

                <div id="afterTrialControls">
                    <!-- <p>Please Enter your Turk ID in the textbox below and click
                        on the Start Study button to Begin the study</p>  -->
                    
                    
                    <!--<input type="text" id="turkId" value="" /> <br><br> -->
                    
                    <p>End of Training. You can now begin the study. </p>
                    
                    <input type="button" id="startStudyButton" value="Start Study" onclick="startStudy()" />

                </div>

                <div id="qualitativeQuestions" style="display:none;">
                    <h4>Final questions</h4>
                    <p>Please answer the following questions about the study. You will be provided with the turkID after this.</p>
                </div>
                <div id="preQualitativeQuestions" style="display:none;">
                    <h4>Before you start</h4>
                    <p>Please answer the following question(s) before starting the tasks for this study</p>
                </div>


                <div id="endOfQuantitative">
                    <h4>End of Study</h4>
                    <p> This is your completion code <span id="turkcode"></span></p>
                    <p></p>
                </div>

            </div>


        </div>


        <input type="hidden" name="studyid" id ="studyid" value="notset"/>

    </body>
</html>
