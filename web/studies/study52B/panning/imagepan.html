<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">

    </style>

    <title>Instrumented Graph</title>
</head>
<body onload="init()" onmouseup="mouseup(event)">

    <script src="d3.v3.min.js"></script>
    <script>

    var imposcx = 0; //the current position/translation of the image
    var imposcy = 0;

    var impospx = 0; //the previous position of the image; used in dragging translation
    var impospy = 0;

    var mx = -1;
    var my = -1;

    function init() {


    }//end init

    function mousedown(e) {
        mx = e.pageX;
        my = e.pageY;

        impospx = imposcx;
        impospy = imposcy;

        e.preventDefault();
        e.stopPropagation();
    }
    
    function mouseup(e) {
        mx = -1;
        my = -1;

        e.preventDefault();
        e.stopPropagation();
    }
    function mousemove(e) {
        document.getElementById("debug").innerHTML = e.pageX;

        if (mx >= 0 && my >= 0) {   //dragging happens
            var im = document.getElementById("im");
            var newy = (impospy + (e.pageY - my));
            var newx = (impospx + (e.pageX - mx));

            //don't allow the image to be moved past some bounds (the limits depend on the size of the visible visualization (800x600 here), and the size of the image)
            if (newx > 0)
                newx = 0;
            else if (newx < -800)
                newx = -800;  //800= imagesize - visiblepanelsize  (1600-800)

            if (newy > 0)
                newy = 0;
            else if (newy < -1000)
                newy = -1000; //1000 = imagesize - visiblepanelsize (1600-600)

            if (e.pageX < 100)   //dragging was done over the row headers; only pan vertically, imposcx remains the same
                newx = imposcx;

            if (e.pageY < 100) //dragging was done over the col headers; only pan horiz, imposcy remains the same
                newy = imposcy;

            document.getElementById("cols").style.left = newx + "px";
            imposcx = newx;
            im.style.left = newx + "px";

            im.style.top = newy + "px";
            imposcy = newy;
            document.getElementById("rows").style.top = newy + "px";

            e.preventDefault();
            e.stopPropagation();
        }

        //draw vertical selection bar
        var selv = document.getElementById("selectionv");

        //where in the image is the cursor?
        var ximage = e.pageX - 100 - imposcx;
        var column = Math.ceil(ximage / 100);
        document.getElementById("cols").innerHTML = "ximage = " + ximage;

        selv.style.left = imposcx + column * 100 + "px";
    }


    </script>


    <div id = "div" style="position : absolute; left: 100px; top: 100px; height : 600px; width : 800px; background: #FFFFCC">
        <img id = "im" src="bla.png" style="position : absolute; left: 0px; top: 0px" onmousedown="mousedown(event)" onmouseup="mouseup(event)" onmousemove="mousemove(event)">
    </div>
    <div id = "colsdiv" style="position : absolute; left: 100px; top: 0px; height : 100px; width : 800px; background: #FFFFCC">
        <img id = "cols" src="cols.png" style="position : absolute; left: 0px; top: 0px; background: #FFFFCC" onmousedown="mousedown(event)" onmouseup="mouseup(event)" onmousemove="mousemove(event)"></img>
    </div>
    <div id = "rowsdiv" style="position : absolute; left: 0px; top: 100px; height : 600px; width : 100px; background: #FFFFCC">
        <img id = "rows" src="rows.png" style="position : absolute; left: 0px; top: 0px; background: #FFFFCC" onmousedown="mousedown(event)" onmouseup="mouseup(event)" onmousemove="mousemove(event)"></img>
    </div>

    <img id = "selectionv" src = "selection.png" style="position : absolute; left: -100px; top: 0px" onmousemove="mousemove(event)" onmousedown="mousedown(event)" onmouseup="mouseup(event)">

    <div id = "debug" style="position : absolute; left: 0px; top: 0px; height : 100px; width : 100px; background: #FFFFCC">
        debug
    </div>
</body>
</html>




